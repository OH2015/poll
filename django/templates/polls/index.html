<!-- templates/index.html -->
{% extends 'base.html' %}
<!-- タイトル -->
{% block title %}トップ画面{% endblock %}
<!-- 追加リソース -->
{% block extra-static %}
<!-- Vue3 -->
<script src="https://unpkg.com/vue@3"></script>
<!-- axios(API非同期通信) -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
{% endblock %}
<!-- 子・メインコンテンツ -->
{% block content %}

<div id="app">
    [[ message ]]
    <input v-on:keydown.enter="search" v-model="keyword" >
    <button v-on:click="search" class="btn">検索</button>
    <ul>
        <li v-for="question in questions">
            <a v-bind:href="'vote/' + question.id + '/'" class="question">
                <p>[[ question.title ]]</p>
                <p class="watched">[[ question.watched ]]view</p>
            </a>
        </li>
    </ul>
</div>

<style>
    .question{
        display: block;
        text-decoration: none;
        border: solid 1px gray;
        border-radius: 10px;
        padding: 5px;
        margin-bottom: 10px;
    }
    .watched{
        text-align: right;
    }
</style>


<script>
    Vue.createApp({
        data() {
            return {
                keyword: "",
                message: '',
                questions: [],
                param:"{}", 
                result:"....",
            }
        }
        ,methods: {
            search(){
                axios.get("/api/questions/",{
                    params:{
                        keyword: this.keyword
                    }
                })
                .then(res => {
                    this.questions = res.data
                })
                .catch(res => {
                    this.message = "検索に失敗しました"
                })
            }
        }
        ,mounted() {
            axios.get("/api/questions/")
            .then(res => {
                this.questions = res.data
                console.log(this.questions)
            })
            .catch(res => {
                this.questions = res.data
                console.log(this.questions)
            })
        }
        // djangoのテンプレートエンジンと競合するので{}から[]に変更
        ,delimiters: ['[[', ']]']
    }).mount('#app')
</script>
{% endblock %}